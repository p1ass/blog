---
title: æœ€è¿‘ã®Goã®OpenAPI Generatorã®æ¨ã—ã¯ogen
date: 2023-09-12T20:00:00
draft: false
description: OpenAPIã‹ã‚‰ã®ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã§ã‚ã‚“ã¾ã‚Šæº€è¶³ã§ãã‚‹ã‚‚ã®ãŒãªã‹ã£ãŸã‚“ã ã‘ã©ã€ogenã¯çµæ§‹è‰¯ã•ã’ãã†ã ã£ãŸ
categories:
  - é–‹ç™º
tags:
  - Go
  - OpenAPI
share: true
---

import { ExLinkCard } from "../../../components/ExLinkCard";

## ã¯ã˜ã‚ã«

OpenAPI ã® yaml ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ Go ã®ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã™ã‚‹ OSS ãƒ„ãƒ¼ãƒ«ã¯ä½•ç¨®é¡ã‹å­˜åœ¨ã—ã¾ã™ã€‚
ã‚ˆãä½¿ã‚ã‚Œã‚‹ã®ã¯[OpenAPITools/openapi-generator](https://github.com/OpenAPITools/openapi-generator)ã‚„[deepmap/oapi-codegen](https://github.com/deepmap/oapi-codegen)ã§ã—ã‚‡ã†ã‹ã€‚

ã‚°ã‚°ã‚‹ã¨æ—¥æœ¬èªã®è¨˜äº‹ã‚‚ãŸãã•ã‚“å‡ºã¦ãã¾ã™ã€‚

<ExLinkCard url="https://tech.layerx.co.jp/entry/generate-go-code-by-openapi-generator" />
<ExLinkCard url="https://techblog.zozo.com/entry/openapi3/go" />
<ExLinkCard url="https://future-architect.github.io/articles/20200701/" />

ã‚‚ã¡ã‚ã‚“ã“ã‚Œã‚‰ã® OSS ã¯ä¾¿åˆ©ãªã®ã§ã™ãŒã€ç”Ÿæˆã•ã‚Œã‚‹ interface ã‚„å‹ãŒå€‹äººçš„ã«ã‚ã¾ã‚Šå¥½ã¿ã§ã¯ãªãã€ãƒ¢ãƒ¤ãƒ¢ãƒ¤ã—ãªãŒã‚‰ä½¿ã£ã¦ã„ã¾ã—ãŸã€‚

ãã‚“ãªä¸­ã€æ–°ã—ã‚ã® OSS ã§ã‚ã‚‹[ogen-dev/ogen](https://github.com/ogen-go/ogen)ã¨ã„ã†ãƒ„ãƒ¼ãƒ«ãŒè‰¯ã•ã’ã ã¨ã„ã†æƒ…å ±ã‚’ã‚­ãƒ£ãƒƒãƒã—ã€å®Ÿéš›ã«ä½¿ã£ã¦ã¿ãŸã¨ã“ã‚è‡ªåˆ†ã®å¥½ã¿ã«ãƒ•ã‚£ãƒƒãƒˆã™ã‚‹ãƒ„ãƒ¼ãƒ«ã ã¨ã„ã†ã“ã¨ãŒè¦‹ãˆã¦ãã¾ã—ãŸã€‚

<ExLinkCard url="https://ogen.dev/" />

{/* <!--more--> */}

## ogen ã®è‰¯ã„ã¨ã“ã‚

### gRPC ãƒ©ã‚¤ã‚¯ãª interface

ogen ã§ç”Ÿæˆã•ã‚Œã‚‹ã‚µãƒ¼ãƒãƒ¼ã® interface ã¯æ¬¡ã®ã‚ˆã†ãªå½¢ã§ã™ã€‚

{/* <!--more--> */}

```go
// Handler handles operations described by OpenAPI v3 specification.
type Handler interface {
    // AddPet implements addPet operation.
    //
    // Add a new pet to the store.
    //
    // POST /pet
    AddPet(ctx context.Context, req *Pet) (*Pet, error)
    // DeletePet implements deletePet operation.
    //
    // Deletes a pet.
    //
    // DELETE /pet/{petId}
    DeletePet(ctx context.Context, params DeletePetParams) error
    // GetPetById implements getPetById operation.
    //
    // Returns a single pet.
    //
    // GET /pet/{petId}
    GetPetById(ctx context.Context, params GetPetByIdParams) (GetPetByIdRes, error)
    // UpdatePet implements updatePet operation.
    //
    // Updates a pet in the store.
    //
    // POST /pet/{petId}
    UpdatePet(ctx context.Context, params UpdatePetParams) error
}
```

gRPC ã‚„ [twirp](https://github.com/twitchtv/twirp)ãªã©ã€Protocol Buffers ãƒ™ãƒ¼ã‚¹ã® RPC ã® interface ã¨éå¸¸ã«ã‚ˆãä¼¼ãŸ interface ã‚’åãå‡ºã—ã¦ãã‚Œã¾ã™ã€‚
ã“ã‚Œã«å¯¾ã—ã€openapi-generator ã‚„ oapi-codegen ã¯æ¬¡ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¾ã™ã€‚

```go
// openapi-generatorã®å ´åˆ

type PetAPIRouter interface {
	AddPet(w http.ResponseWriter, r *http.Request)
	DeletePet(w http.ResponseWriter, r *http.Request)
	FindPetById(w http.ResponseWriter, r *http.Request)
	FindPets(w http.ResponseWriter, r *http.Request)
}
```

```go
// oapi-codegen (echoãƒ™ãƒ¼ã‚¹)ã®å ´åˆ

type ServerInterface interface {
	AddPet(ctx echo.Context) error
	DeletePet(ctx echo.Context, id int64) error
	GetPetById(ctx echo.Context, id int64) error
}
```

ã“ã‚Œã‚‰ã®ãƒ„ãƒ¼ãƒ«ã¯ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«ã‚ˆã£ã¦ä»–ã®å½¢å¼ã§å‡ºåŠ›ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ãŒã€`MethodName(ctx, param) (response, error)` ã¨ã„ã†å½¢å¼ã§å‡ºåŠ›ã—ã¦ãã‚Œã‚‹ã‚‚ã®ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚å¤šåˆ†ã€‚

interface ã¯ã¶ã£ã¡ã‚ƒã‘å¥½ã¿ã®é ˜åŸŸãªã¨ã“ã‚ã‚‚ã‚ã‚Šã¾ã™ãŒã€åƒ•ã¯ ogen ã®å½¢å¼ãŒå¥½ãã ãªã€œã¨æ€ã£ã¦ã¾ã™ã€‚

##### 2023-09-13 è¿½è¨˜

SNS ã§æ•™ãˆã¦ã„ãŸã ã„ãŸã®ã§ã™ãŒã€oapi-codegen ã® Strict server generation ã®æ©Ÿèƒ½ã‚’ä½¿ã†ã¨ã€ä¼¼ãŸã‚ˆã†ãª interface ã‚’ç”Ÿæˆã§ãã‚‹ã‚ˆã†ã§ã™ã€‚

https://github.com/deepmap/oapi-codegen/tree/master#strict-server-generation

### null ã‚„ optional ã«å¯¾ã—ã¦ã¡ã‚ƒã‚“ã¨å‹ã‚’ä»˜ã‘ã‚ˆã†ã¨åŠªåŠ›ã—ã¦ã„ã‚‹

`null` ã‚„ `optional` ã¯ OpenAPI ã®ä»•æ§˜ã®ä¸­ã§ã‚‚ã‚„ã‚„ã“ã—ã„éƒ¨é¡ã®ã‚‚ã®ã§ã™ãŒã€ogen ã¯ãã‚Œã‚‰ã«å¯¾ã—ã¦çœŸã£å‘ã‹ã‚‰å¯¾å¿œã—ã¦ãã‚Œã¦ã„ã¾ã™ã€‚

<ExLinkCard url="https://ogen.dev/docs/types/optional" />

ä¸‹è¨˜ã® 4 ã¤ã®å‹ã‚’æ˜ç¢ºã«åŒºåˆ¥ã—ã€ãã®å‹ã«å¯¾å¿œã™ã‚‹å½¢ã§ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¦ãã‚Œã¾ã™ã€‚

- required: `T`
- optional: `Opt[#T]`
- nullable, but required: `Nil[#T]`
- optional & nullable: `OptNil[#T]`

optional & nullable ã®å ´åˆã¯ã“ã‚“ãªæ„Ÿã˜ã€‚

```go
// OptNilString is optional nullable string.
type OptNilString struct {
    Value string
    Set   bool
    Null  bool
}

// IsSet returns true if OptNilString was set.
func (o OptNilString) IsSet() bool
// Reset unsets value.
func (o *OptNilString) Reset()
// SetTo sets value to v.
func (o *OptNilString) SetTo(v string)
// IsSet returns true if value is Null.
func (o OptNilString) IsNull() bool
// Get returns value and boolean that denotes whether value was set.
func (o OptNilString) Get() (v string, ok bool)
// Or returns value if set, or given parameter if does not.
func (o OptNilString) Or(d string) string

func NewOptNilString(v string) OptNilString
```

ã“ã†ã„ã† Optional å‹ã¯è‡ªåˆ†ã§æ›¸ãã®ã¯é¢å€’ãã•ã„ã‚“ã ã‘ã©ã€è‡ªå‹•ç”Ÿæˆã—ã¦ãã‚Œã‚‹ãªã‚‰ã‚ã‚ŠãŒãŸãä½¿ã£ã¡ã‚ƒãŠã†ã‹ãªã€œã¨æ€ãˆã‚‹ä¾¿åˆ©ã•ãŒã‚ã‚Šã¾ã—ãŸã€‚

### OpenTelemetry ã®æ¨™æº–ã‚µãƒãƒ¼ãƒˆ

ã“ã®æ‰‹ã®ãƒ„ãƒ¼ãƒ«ã§ã¯çã—ã„ã®ã§ã™ãŒã€OpenTelemetry ã® Trace ã‚„ Metrics ã‚’æ¨™æº–ã§ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚

å€‹äººçš„ã« OpenTelemetry ã¯ã‚‚ã£ã¨æ™®åŠã—ã¦ã»ã—ã„ãªãã¨æ€ã£ã¦ã‚‹ã®ã§ã€ã“ã†ã„ã£ãŸ HTTP ã‚µãƒ¼ãƒãƒ¼ã‚„ HTTP ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«æ¨™æº–ã§çµ„ã¿è¾¼ã¾ã‚Œã¦ã„ãå‹•ãã¯ã¨ã¦ã‚‚ ğŸ‘ ã§ã™ã€‚

## ãŠã‚ã‚Šã«

ä»Šå›ã¯ç°¡å˜ãª ogen ã®ç´¹ä»‹è¨˜äº‹ã§ã—ãŸã€‚

å®Ÿéš›ã«ä½¿ã„è¾¼ã‚“ã§ã„ãã¨ã€ã€Œã“ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å€¤ã£ã¦ã©ã†ã‚„ã£ã¦å–ã‚‹ã®ï¼Ÿã€ã€ã€Œã†ã¾ãç”Ÿæˆã§ããªã„ã‚“ã ã‘ã©ã€ã¨ã„ã†ãƒ‘ã‚¿ãƒ¼ãƒ³ã«é­é‡ã™ã‚‹ã“ã¨ã¯ã‚ã‚‹ã¨æ€ã„ã¾ã™(å®Ÿéš›ã«ã‚ã‚Šã¾ã—ãŸ)ãŒã€ã¾ãšã¯ã‚‚ã®ã®è©¦ã—ã§ä½¿ã£ã¦ã¿ã‚‹ã¨è‰²ã€…ã¨è¦‹ãˆã¦ãã‚‹ã‚‚ã®ãŒã‚ã‚Šãã†ã§ã™ã€‚
